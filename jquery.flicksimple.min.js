/**
 * jQuery.flickSimple v1.2.0
 *
 * Copyright (c) 2011 Makog. http://d.hatena.ne.jp/makog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */
 (function(d){d.flickSimple=function(c,a){this.setup(d(c),a)};d.extend(d.flickSimple.prototype,{elm:null,target:null,disabled:!1,snap:"element",ratio:5,duration:600,lock:!1,onChange:null,onResize:null,onAnimationEnd:null,onClick:null,vertical:!1,horizontal:!0,paginate:"x",elmWidth:0,elmHeight:0,page:1,pageWidth:0,pageHeight:0,pageLength:0,android:!1,webkit:!0,touchable:!0,anc:null,touchhold:!1,startX:null,startY:null,preX:0,preY:0,currentX:0,currentY:0,flickX:0,flickY:0,nextX:0,nextY:0,debug:null,
setup:function(c,a){var b=this;b.debug=d("#debug");b.elm=c;b.elm.css({overflow:"hidden"});b.target=a.target||d(b.elm.children().get(0));b.android=void 0===a.android?-1!==navigator.userAgent.indexOf("Android"):a.android;b.webkit="undefined"!==typeof WebKitTransitionEvent;b.touchable="undefined"!==typeof ontouchstart;if(void 0!==a.disabled)b.disabled=a.disabled;if(void 0!==a.snap)b.snap=a.snap;if(void 0!==a.ratio)b.ratio=a.ratio;if(void 0!==a.duration)b.duration=a.duration;if(void 0!==a.lock)b.lock=
a.lock;if(void 0!==a.vertical)b.vertical=a.vertical;if(void 0!==a.horizontal)b.horizontal=a.horizontal;if(void 0!==a.paginate)b.paginate=a.paginate;b.onChange=a.onChange;b.onResize=a.onResize;b.onAnimationEnd=a.onAnimationEnd;b.onClick=a.onClick;"object"===typeof window.onorientationchange&&!b.android?d(window).bind("orientationchange",function(){b.updateSize()}):d(window).bind("resize",function(){b.updateSize()});b.init();b.android||!b.webkit?b.target.css({position:"relative"}):b.target.css({position:"relative",
webkitTransition:"none",webkitTransform:"translate3d(0,0,0)"});b.updateSize();b.touchable?b.elm.bind("touchstart",function(a){b.touchstart(a)}).bind("touchmove",function(a){b.touchmove(a)}).bind("touchend",function(a){b.touchend(a)}):(b.elm.bind("mousedown",function(a){b.touchstart(a)}),d("body").bind("mouseup",function(a){b.touchend(a)}).bind("mousemove",function(a){b.touchmove(a)}));b.target.bind("webkitTransitionEnd",function(a){if(d.isFunction(b.onAnimationEnd))b.onAnimationEnd(a)});return b},
nextPage:function(c){return this.goTo(this.page+(c||1))},prevPage:function(c){return this.goTo(this.page-(c||1))},goTo:function(c){if(c>this.pageLength)c=this.pageLength;c--;var a,b,d;"y"===this.paginate?(d=Math.ceil(this.elmHeight/this.pageHeight)+1,a=Math.floor(c/d),b=c%d):(d=Math.ceil(this.elmWidth/this.pageWidth)+1,b=Math.floor(c/d),a=c%d);return this.move(-(a*this.pageWidth),-(b*this.pageHeight))},move:function(c,a){!this.horizontal||0<=c?c=0:c<-this.elmWidth&&(c=-this.elmWidth);!this.vertical||
0<=a?a=0:a<-this.elmHeight&&(a=-this.elmHeight);this.android||!this.webkit?this.target.animate({left:c+"px",top:a+"px"}):this.target.css({webkitTransition:"-webkit-transform 0.3s ease-in",webkitTransform:"translate3d("+c+"px,"+a+"px,0)"});return this.update(c,a)},updateSize:function(){var c="undefined"!==typeof window.orientation?0===window.orientation?"portrait":"landscape":window.innerWidth<window.innerHeight?"portrait":"landscape",a=this.target.children();this.elm.removeClass("landscape portrait").addClass(c);
this.target.removeClass("landscape portrait").addClass(c);a.removeClass("landscape portrait").addClass(c);var c=this.target.width(),b=this.target.height(),e=this.elm.width(),g=this.elm.height();this.elmWidth=c-e;this.elmHeight=b-g;this.pageLength=this.pageHeight=this.pageWidth=0;if(this.snap){if("element"===this.snap)this.pageWidth=e,this.pageHeight=g;else if("first"===this.snap)this.pageWidth=d(a.get(0)).width(),this.pageHeight=d(a.get(0)).height();else if("smallest"===this.snap){var f=0;a.each(function(){var a=
d(this).width();if(f>a||0==f)f=a});this.pageWidth=f;f=0;a.each(function(){var a=d(this).height();if(f>a||0==f)f=a});this.pageHeight=f}else if("object"===typeof this.snap)this.pageWidth=this.snap[0],this.pageHeight=this.snap[1];else if(!isNaN(this.snap))this.pageHeight=this.pageWidth=this.snap;this.pageLength=Math.ceil(c/this.pageWidth);b>this.pageHeight&&(this.pageLength*=Math.ceil(b/this.pageHeight))}if(d.isFunction(this.onResize))this.onResize();this.goTo(this.page);return this},touchstart:function(c){var a=
this,b=a.touchable?event.changedTouches[0]:c;if(!a.disabled){a.startX=b.clientX;a.startY=b.clientY;a.touchhold=!1;c="A"===c.target.tagName?d(c.target):d(c.target).closest("a");if(0<c.length)a.anc=c;setTimeout(function(){if(a.anc){a.touchhold=!0;var b=a.anc,c=d.data(b.get(0),"flickSimple.link");c&&(b.attr("href",c),setTimeout(function(){b&&b.attr("href","javascript:;")},200))}},600)}},touchmove:function(c){if(!this.disabled)if((this.android||this.lock)&&c.preventDefault(),null===this.startX||null===
this.startY)this.anc=null;else{var c=this.touchable?c.originalEvent.touches[0]:c,a=c.clientX,b=c.clientY;if(16<Math.abs(this.startX-a)||16<Math.abs(this.startY-c.clientY))this.anc=null;this.nextX=this.horizontal?(this.currentX||0)+(a-this.startX):0;this.nextY=this.vertical?(this.currentY||0)+(b-this.startY):0;this.android||!this.webkit?this.target.css({left:this.nextX+"px",top:this.nextY}):this.target.css({webkitTransition:"none",webkitTransform:"translate3d("+this.nextX+"px,"+this.nextY+"px,0)"});
this.flickX=this.preX-a;this.flickY=this.preY-b;this.preX=a;this.preY=b}},touchend:function(c){if(!this.disabled&&!(null===this.startX||null===this.startY)){this.startY=this.startX=null;if(this.anc&&!this.touchhold){if(d.isFunction(this.onClick))this.onClick(this.anc);var a=this.anc.get(0),b=d.data(a,"flickSimple.link"),a=d.data(a,"flickSimple.target");if(b)a&&"_self"!==a?("_blank"===a&&(a=""),window.open(b,a)):location.href=b;c.preventDefault()}this.touchhold=!1;c=this.nextX+this.flickX*-this.ratio;
b=this.nextY+this.flickY*-this.ratio;this.pageWidth&&(a=c%this.pageWidth,c=a<-this.pageWidth/2?c-(a+this.pageWidth):c-a,a=b%this.pageHeight,b=a<-this.pageHeight/2?b-(a+this.pageHeight):b-a);!this.horizontal||0<=c?c=0:c<-this.elmWidth&&(c=-this.elmWidth);!this.vertical||0<=b?b=0:b<-this.elmHeight&&(b=-this.elmHeight);this.android||!this.webkit?this.target.animate({left:c+"px",top:b+"px"},this.duration,function(a,b,c,d,h){return-d*(b/=h)*(b-2)+c}):this.target.css({webkitTransition:"-webkit-transform "+
this.duration/1E3+"s ease-out",webkitTransform:"translate3d("+c+"px,"+b+"px,0)"});this.update(c,b)}},update:function(c,a){if(this.pageWidth||this.pageHeight){var b;"y"===this.paginate?(b=Math.ceil(this.elmHeight/this.pageHeight)+1,this.page=Math.ceil(-a/this.pageHeight)+Math.ceil(-c/this.pageWidth)*b+1):(b=Math.ceil(this.elmWidth/this.pageWidth)+1,this.page=Math.ceil(-c/this.pageWidth)+Math.ceil(-a/this.pageHeight)*b+1)}if(this.currentX!==c||this.currentY!==a)if(this.currentX=c,this.currentY=a,d.isFunction(this.onChange))this.onChange();
return this},no_mousedown:function(c){c.preventDefault()},init:function(){var c=this;c.target.find("a").each(function(){var a=d(this),b=a.attr("href"),e=a.attr("target");b&&"javascript:;"!==b&&d.data(this,"flickSimple.link",b);d.data(this,"flickSimple.target",e||"");a.attr("href","javascript:;").removeAttr("target");c.touchable||a.unbind("mousedown",c.no_mousedown).bind("mousedown",c.no_mousedown)});c.touchable||c.target.find("img").unbind("mousedown",c.no_mousedown).bind("mousedown",c.no_mousedown);
return c}});d.fn.flickSimple=function(c){var a=this;if("string"===typeof c){var b=Array.prototype.slice.call(arguments,1);this.each(function(){var e=d.data(this,"flickSimple"),g;e&&(d.isFunction(e[c])?g=e[c].apply(e,b):(0<b.length&&(e[c]=b[1]),g=e[c]));g!==e&&(a=g)})}else this.each(function(){var b=d.data(this,"flickSimple");b?a=b:d.data(this,"flickSimple",new d.flickSimple(this,c||{}))});return a}})(jQuery);
