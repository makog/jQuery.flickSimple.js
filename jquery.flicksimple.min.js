/**
 * jQuery.flickSimple v1.2.0
 *
 * Copyright (c) 2011 Makog. http://d.hatena.ne.jp/makog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */
 (function(d){d.flickSimple=function(b,a){this.setup(d(b),a)};d.extend(d.flickSimple.prototype,{elm:null,target:null,snap:"element",ratio:5,duration:600,lock:!1,onChange:null,onResize:null,onAnimationEnd:null,onClick:null,vertical:!1,horizontal:!0,paginate:"x",elmWidth:0,elmHeight:0,page:1,pageWidth:0,pageHeight:0,pageLength:0,android:!1,webkit:!0,touchable:!0,anc:null,touchhold:!1,startX:null,startY:null,preX:0,preY:0,currentX:0,currentY:0,flickX:0,flickY:0,nextX:0,nextY:0,debug:null,setup:function(b,
a){var c=this;c.debug=d("#debug");c.elm=b;c.elm.css({overflow:"hidden"});c.target=a.target||d(c.elm.children().get(0));c.android=void 0===a.android?-1!==navigator.userAgent.indexOf("Android"):a.android;c.webkit="undefined"!==typeof WebKitTransitionEvent;c.touchable="undefined"!==typeof ontouchstart;if(void 0!==a.snap)c.snap=a.snap;if(void 0!==a.ratio)c.ratio=a.ratio;if(void 0!==a.duration)c.duration=a.duration;if(void 0!==a.lock)c.lock=a.lock;if(void 0!==a.vertical)c.vertical=a.vertical;if(void 0!==
a.horizontal)c.horizontal=a.horizontal;if(void 0!==a.paginate)c.paginate=a.paginate;c.onChange=a.onChange;c.onResize=a.onResize;c.onAnimationEnd=a.onAnimationEnd;c.onClick=a.onClick;"object"===typeof window.onorientationchange&&!c.android?d(window).bind("orientationchange",function(){c.updateSize()}):d(window).bind("resize",function(){c.updateSize()});c.init();c.android||!c.webkit?c.target.css({position:"relative"}):c.target.css({position:"relative",webkitTransition:"none",webkitTransform:"translate3d(0,0,0)"});
c.updateSize();c.touchable?c.elm.bind("touchstart",function(a){c.touchstart(a)}).bind("touchmove",function(a){c.touchmove(a)}).bind("touchend",function(a){c.touchend(a)}):(c.elm.bind("mousedown",function(a){c.touchstart(a)}),d("body").bind("mouseup",function(a){c.touchend(a)}).bind("mousemove",function(a){c.touchmove(a)}));c.target.bind("webkitTransitionEnd",function(a){if(d.isFunction(c.onAnimationEnd))c.onAnimationEnd(a)});return c},nextPage:function(b){return this.goTo(this.page+(b||1))},prevPage:function(b){return this.goTo(this.page-
(b||1))},goTo:function(b){if(b>this.pageLength)b=this.pageLength;b--;var a,c,d;"y"===this.paginate?(d=Math.ceil(this.elmHeight/this.pageHeight)+1,a=Math.floor(b/d),c=b%d):(d=Math.ceil(this.elmWidth/this.pageWidth)+1,c=Math.floor(b/d),a=b%d);return this.move(-(a*this.pageWidth),-(c*this.pageHeight))},move:function(b,a){!this.horizontal||0<=b?b=0:b<-this.elmWidth&&(b=-this.elmWidth);!this.vertical||0<=a?a=0:a<-this.elmHeight&&(a=-this.elmHeight);this.android||!this.webkit?this.target.animate({left:b+
"px",top:a+"px"}):this.target.css({webkitTransition:"-webkit-transform 0.3s ease-in",webkitTransform:"translate3d("+b+"px,"+a+"px,0)"});this.nextX=b;this.nextY=a;return this.update(b,a)},updateSize:function(){var b="undefined"!==typeof window.orientation?0===window.orientation?"portrait":"landscape":window.innerWidth<window.innerHeight?"portrait":"landscape",a=this.target.children();this.elm.removeClass("landscape portrait").addClass(b);this.target.removeClass("landscape portrait").addClass(b);a.removeClass("landscape portrait").addClass(b);
var b=this.target.width(),c=this.target.height(),e=this.elm.width(),g=this.elm.height();this.elmWidth=b-e;this.elmHeight=c-g;this.pageLength=this.pageHeight=this.pageWidth=0;if(this.snap){if("element"===this.snap)this.pageWidth=e,this.pageHeight=g;else if("first"===this.snap)this.pageWidth=d(a.get(0)).width(),this.pageHeight=d(a.get(0)).height();else if("smallest"===this.snap){var f=0;a.each(function(){var a=d(this).width();if(f>a||0==f)f=a});this.pageWidth=f;f=0;a.each(function(){var a=d(this).height();
if(f>a||0==f)f=a});this.pageHeight=f}else if("object"===typeof this.snap)this.pageWidth=this.snap[0],this.pageHeight=this.snap[1];else if(!isNaN(this.snap))this.pageHeight=this.pageWidth=this.snap;this.pageLength=Math.ceil(b/this.pageWidth);c>this.pageHeight&&(this.pageLength*=Math.ceil(c/this.pageHeight))}if(d.isFunction(this.onResize))this.onResize();this.goTo(this.page);return this},touchstart:function(b){var a=this,c=a.touchable?event.changedTouches[0]:b;a.startX=c.clientX;a.startY=c.clientY;
a.touchhold=!1;b="A"===b.target.tagName?d(b.target):d(b.target).closest("a");if(0<b.length)a.anc=b;setTimeout(function(){if(a.anc){a.touchhold=!0;var b=a.anc,c=d.data(b.get(0),"flickSimple.link");c&&(b.attr("href",c),setTimeout(function(){b&&b.attr("href","javascript:;")},200))}},600)},touchmove:function(b){(this.android||this.lock)&&b.preventDefault();if(null===this.startX||null===this.startY)this.anc=null;else{var b=this.touchable?b.originalEvent.touches[0]:b,a=b.clientX,c=b.clientY;if(16<Math.abs(this.startX-
a)||16<Math.abs(this.startY-b.clientY))this.anc=null;this.nextX=this.horizontal?(this.currentX||0)+(a-this.startX):0;this.nextY=this.vertical?(this.currentY||0)+(c-this.startY):0;this.android||!this.webkit?this.target.css({left:this.nextX+"px",top:this.nextY}):this.target.css({webkitTransition:"none",webkitTransform:"translate3d("+this.nextX+"px,"+this.nextY+"px,0)"});this.flickX=this.preX-a;this.flickY=this.preY-c;this.preX=a;this.preY=c}},touchend:function(b){if(!(null===this.startX||null===this.startY)){this.startY=
this.startX=null;if(this.anc&&!this.touchhold){if(d.isFunction(this.onClick))this.onClick(this.anc);var a=this.anc.get(0),c=d.data(a,"flickSimple.link"),a=d.data(a,"flickSimple.target");if(c)a&&"_self"!==a?("_blank"===a&&(a=""),window.open(c,a)):location.href=c;b.preventDefault()}this.touchhold=!1;b=this.nextX+this.flickX*-this.ratio;c=this.nextY+this.flickY*-this.ratio;this.pageWidth&&(a=b%this.pageWidth,b=a<-this.pageWidth/2?b-(a+this.pageWidth):b-a,a=c%this.pageHeight,c=a<-this.pageHeight/2?c-
(a+this.pageHeight):c-a);!this.horizontal||0<=b?b=0:b<-this.elmWidth&&(b=-this.elmWidth);!this.vertical||0<=c?c=0:c<-this.elmHeight&&(c=-this.elmHeight);this.android||!this.webkit?this.target.animate({left:b+"px",top:c+"px"},this.duration,function(a,b,c,d,h){return-d*(b/=h)*(b-2)+c}):this.target.css({webkitTransition:"-webkit-transform "+this.duration/1E3+"s ease-out",webkitTransform:"translate3d("+b+"px,"+c+"px,0)"});this.update(b,c)}},update:function(b,a){if(this.pageWidth||this.pageHeight){var c;
"y"===this.paginate?(c=Math.ceil(this.elmHeight/this.pageHeight)+1,this.page=Math.ceil(-a/this.pageHeight)+Math.ceil(-b/this.pageWidth)*c+1):(c=Math.ceil(this.elmWidth/this.pageWidth)+1,this.page=Math.ceil(-b/this.pageWidth)+Math.ceil(-a/this.pageHeight)*c+1)}if(this.currentX!==b||this.currentY!==a)if(this.currentX=b,this.currentY=a,d.isFunction(this.onChange))this.onChange();return this},no_mousedown:function(b){b.preventDefault()},init:function(){var b=this;b.target.find("a").each(function(){var a=
d(this),c=a.attr("href"),e=a.attr("target");c&&"javascript:;"!==c&&d.data(this,"flickSimple.link",c);d.data(this,"flickSimple.target",e||"");a.attr("href","javascript:;").removeAttr("target");b.touchable||a.unbind("mousedown",b.no_mousedown).bind("mousedown",b.no_mousedown)});b.touchable||b.target.find("img").unbind("mousedown",b.no_mousedown).bind("mousedown",b.no_mousedown);return b}});d.fn.flickSimple=function(b){var a=this;if("string"===typeof b){var c=Array.prototype.slice.call(arguments,1);
this.each(function(){var e=d.data(this,"flickSimple"),g;e&&(d.isFunction(e[b])?g=e[b].apply(e,c):(0<c.length&&(e[b]=c[1]),g=e[b]));g!==e&&(a=g)})}else this.each(function(){var c=d.data(this,"flickSimple");c?a=c:d.data(this,"flickSimple",new d.flickSimple(this,b||{}))});return a}})(jQuery);
