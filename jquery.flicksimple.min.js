/**
 * jQuery.flickSimple v1.1.1
 *
 * Copyright (c) 2011 Makog. http://d.hatena.ne.jp/makog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */
(function(d){d.flickSimple=function(a,b){this.setup(d(a),b)};d.extend(d.flickSimple.prototype,{elm:null,target:null,snap:"element",ratio:5,duration:600,lock:!1,onChange:null,onResize:null,onAnimationEnd:null,onClick:null,elmWidth:0,page:1,pageWidth:0,pageLength:0,android:!1,webkit:!0,touchable:!0,anc:null,startX:null,preX:0,currentX:0,flickX:0,nextX:0,setup:function(a,b){var c=this;c.elm=a;c.elm.css({overflow:"hidden"});c.target=b.target||c.elm.find("ul");c.android=b.android===void 0?navigator.userAgent.indexOf("Android")!=
-1:b.android;c.webkit=typeof WebKitTransitionEvent!=="undefined";c.touchable=typeof ontouchstart!=="undefined";if(b.snap!==void 0)c.snap=b.snap;if(b.ratio!==void 0)c.ratio=b.ratio;if(b.duration!==void 0)c.duration=b.duration;if(b.lock!==void 0)c.lock=b.lock;c.onChange=b.onChange;c.onResize=b.onResize;c.onAnimationEnd=b.onAnimationEnd;c.onClick=b.onClick;typeof window.onorientationchange==="object"&&!c.android?d(window).bind("orientationchange",function(){c.updateSize()}):d(window).bind("resize",function(){c.updateSize()});
c.init();c.android||!c.webkit?c.target.css({position:"relative"}):c.target.css({position:"relative",webkitTransition:"none",webkitTransform:"translate3d(0,0,0)"});c.updateSize();c.touchable?c.elm.bind("touchstart",function(a){c.touchstart(a)}).bind("touchmove",function(a){c.touchmove(a)}).bind("touchend",function(a){c.touchend(a)}):(c.elm.bind("mousedown",function(a){c.touchstart(a)}),d("body").bind("mouseup",function(a){c.touchend(a)}).bind("mousemove",function(a){c.touchmove(a)}));c.target.bind("webkitTransitionEnd",
function(a){if(d.isFunction(c.onAnimationEnd))c.onAnimationEnd(a)});return c},nextPage:function(a){return this.goTo(this.page+(a||1))},prevPage:function(a){return this.goTo(this.page-(a||1))},goTo:function(a){return this.move(-((a-1)*this.pageWidth))},move:function(a){a>0?a=0:a<-this.elmWidth&&(a=-this.elmWidth);this.android||!this.webkit?this.target.animate({left:a+"px"}):this.target.css({webkitTransition:"-webkit-transform 0.3s ease-in",webkitTransform:"translate3d("+a+"px,0,0)"});return this.update(a)},
updateSize:function(){var a=typeof window.orientation!=="undefined"?window.orientation===0?"portrait":"landscape":window.innerWidth<window.innerHeight?"portrait":"landscape",b=this.target.find("li");this.elm.removeClass("landscape portrait").addClass(a);this.target.removeClass("landscape portrait").addClass(a);b.removeClass("landscape portrait").addClass(a);var a=this.target.width(),c=this.elm.width();this.elmWidth=a-c;if(this.snap=="element")this.pageWidth=c;else if(this.snap=="first")this.pageWidth=
d(b.get(0)).width();else if(this.snap=="smallest"){var e=0;b.each(function(){var a=d(this).width();if(e>a||e==0)e=a});this.pageWidth=e}else this.pageWidth=isNaN(this.snap)?0:this.snap;this.pageLength=Math.ceil(a/this.pageWidth);if(d.isFunction(this.onResize))this.onResize();this.goTo(this.page);return this},touchstart:function(a){var b=this;b.startX=(b.touchable?event.changedTouches[0]:a).clientX;a=a.target.tagName==="A"?d(a.target):d(a.target).closest("a");if(a.length>0)b.anc=a;setTimeout(function(){if(b.anc){b.startX=
null;var a=b.anc,e=d.data(a.get(0),"flickSimple.link");e&&(a.attr("href",e),setTimeout(function(){a&&a.attr("href","javascript:;")},200))}},600)},touchmove:function(a){(this.android||this.lock)&&a.preventDefault();this.anc=null;if(this.startX!==null)a=(this.touchable?a.originalEvent.touches[0]:a).clientX,this.nextX=(this.currentX||0)+(a-this.startX),this.android||!this.webkit?this.target.css({left:this.nextX+"px"}):this.target.css({webkitTransition:"none",webkitTransform:"translate3d("+this.nextX+
"px,0,0)"}),this.flickX=this.preX-a,this.preX=a},touchend:function(){if(this.startX!==null){this.startX=null;if(this.anc){if(d.isFunction(this.onClick))this.onClick(this.anc);var a=this.anc.get(0),b=d.data(a,"flickSimple.link"),a=d.data(a,"flickSimple.target");if(b)a&&a!=="_self"?(a==="_blank"&&(a=""),window.open(b,a)):location.href=b;return!1}b=this.nextX+this.flickX*-this.ratio;this.pageWidth&&(a=b%this.pageWidth,b-=a<-this.pageWidth/2?a+this.pageWidth:a);b>0?b=0:b<-this.elmWidth&&(b=-this.elmWidth);
this.android||!this.webkit?this.target.animate({left:b+"px"},this.duration,function(a,b,d,g,h){return-g*(b/=h)*(b-2)+d}):this.target.css({webkitTransition:"-webkit-transform "+this.duration/1E3+"s ease-out",webkitTransform:"translate3d("+b+"px,0,0)"});this.update(b)}},update:function(a){if(this.pageWidth)this.page=Math.ceil(a*-1/this.pageWidth)+1;if(this.currentX!==a&&(this.currentX=a,d.isFunction(this.onChange)))this.onChange();return this},no_mousedown:function(a){a.preventDefault()},init:function(){var a=
this;a.target.find("a").each(function(){var b=d(this),c=b.attr("href"),e=b.attr("target");c&&c!="javascript:;"&&d.data(this,"flickSimple.link",c);d.data(this,"flickSimple.target",e||"");b.attr("href","javascript:;").removeAttr("target");a.touchable||b.unbind("mousedown",a.no_mousedown).bind("mousedown",a.no_mousedown)});a.touchable||a.target.find("img").unbind("mousedown",a.no_mousedown).bind("mousedown",a.no_mousedown);return a}});d.fn.flickSimple=function(a){var b=this;if(typeof a==="string"){var c=
Array.prototype.slice.call(arguments,1);this.each(function(){var e=d.data(this,"flickSimple"),f;e&&(d.isFunction(e[a])?f=e[a].apply(e,c):(c.length>0&&(e[a]=c[1]),f=e[a]));f!==e&&(b=f)})}else this.each(function(){var c=d.data(this,"flickSimple");c?b=c:d.data(this,"flickSimple",new d.flickSimple(this,a||{}))});return b}})(jQuery);